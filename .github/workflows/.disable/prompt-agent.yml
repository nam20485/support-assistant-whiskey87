name: Prompt Claude Code

on:
    push:
        branches:
            - main
        paths:
            - "plan_docs/*"
    workflow_dispatch:
        inputs:
            workflow_name:
                description: "Name of the workflow to orchestrate"
                required: true
                default: "project-setup"

jobs:
    claude:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            pull-requests: read
            issues: read
            id-token: write
            actions: read # Required for Claude to read CI results on PRs
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 1

            - name: Run Claude Code
              id: claude
              uses: anthropics/claude-code-action@v1
              with:
                  claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}

                  # This is an optional setting that allows Claude to read CI results on PRs
                  additional_permissions: |
                      actions: read

                  # Optional: Give a custom prompt to Claude. If this is not specified, Claude will perform the instructions specified in the comment that tagged it.
                  # prompt: 'Update the pull request description to include a summary of changes.'
                  prompt: perform the orchestrate-dynamic-workflow with $workflow_name = "project-setup-upgraded"

                  # Optional: Add claude_args to customize behavior and configuration
                  # See https://github.com/anthropics/claude-code-action/blob/main/docs/usage.md
                  # or https://docs.anthropic.com/en/docs/claude-code/sdk#command-line for available options
                  # claude_args: '--model claude-opus-4-1-20250805 --allowed-tools Bash(gh pr:*)'
